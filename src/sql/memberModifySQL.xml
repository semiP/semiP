<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC '-//ibatis.apache.org//DTD Sql Map 2.0//EN' 'http://ibatis.apache.org/dtd/sql-map-2.dtd'>
<sqlMap namespace="mypage1">
	<typeAlias alias="member" type="mypage.memberBean"/>
	
	<!-- result map 정의 -->
	<resultMap id="memberRes" class="member">
		<result property="member_no" column="member_no"/>
		<result property="member_name" column="member_name"/>
		<result property="member_id" column="member_id"/>
		<result property="member_pw" column="member_pw"/>
		<result property="member_zipcode" column="member_zipcode"/>
		<result property="member_address1" column="member_address1"/>
		<result property="member_address2" column="member_address2"/>
		<result property="member_phone" column="member_phone"/>
		<result property="member_email" column="member_email"/>
		<result property="member_regdate" column="member_regdate"/>
		<result property="member_level" column="member_level"/>
		<result property="member_deleteReason" column="member_deleteReason"/> <!-- member table에 reason column추가 -->
	</resultMap>
	
	<!--
   		MEMBER table에서 
    	MEMBER_NAME,  MEMBER_EMAIL, MEMBER_ZIPCODE, MEMBER_ADDRESS1, MEMBER_ADDRESS2, MEMBER_PHONE, MEMBER_PW를 
    	select를 이용하여 값 추출 후 화면에 보여줌
    -->
    
    <!-- select-all -->
    	<sql id="select-all-member">
			SELECT * FROM MEMBER
		</sql>
		
		<!-- select 쿼리문 정의 -->
		<select id="selectAllmember" resultMap="memberRes" parameterClass="int">
			<include refid="select-all-member" />
			ORDER BY member_no DESC
		</select>
		
	<!-- select-one -->
		<select id="selectOneMember" resultMap="memberRes" parameterClass="int">
			<include refid="select-all-member" />
		</select>
   
   <!-- 우편 번호 찾기 -->
		<select id="zipCheckAction" resultMap="zipcodeRes" parameterClass="String">
			select * from member where member_zipcode like #member_zipcode#
		</select>
		
	<!-- 비밀번호 일치여부 쿼리문 -->
		<select id="pwCheck" resultMap="memberRes" parameterClass="String">
			<include refid="select-all-member"/>
			where member_no=#member_no#
			and member_pw = #member_pw#
		</select>
		
	<!-- 회원정보 수정 쿼리문 -->
		<update id="updateMember" parameterClass="member">
			update member set 
					member_email=#member_email#
					member_zipcode=#member_zipcode#
					member_address1=#member_address1#
					member_address2=#member_address2#
					member_phone=#member_phone#
					member_pw=#member_pw#
			where member_no=#member_no#
		</update>
		
	<!-- 비밀번호 수정 쿼리문 -->
		<update id="updateMemberPW" parameterClass="member">
			update member set
				member_pw = #member_pw#
			where member_no=#member_no#
		</update>
		
	<!-- 회원탈퇴 관련 쿼리문 -->
		<insert id="insertMemberDeleteReason" parameterClass="member">
			insert into member
				member_deleteReason values #member_deleteReason#
		</insert>
		
		<update id="updateMemberDelete" parameterClass="member">
			update member_level = 2 from member
		</update>
</sqlMap>